---
import Footer from "../components/layout/Footer.astro";
import { Header } from "../components/layout/Header";
import { toolCategories, tools } from "../data/tools";
import Layout from "../layouts/Layout.astro";

// Group tools by category
const toolsByCategory = new Map<string, typeof tools>();
for (const tool of tools) {
  if (!toolsByCategory.has(tool.category)) {
    toolsByCategory.set(tool.category, []);
  }
  toolsByCategory.get(tool.category)?.push(tool);
}

// Get category info
function getCategoryInfo(id: string) {
  return (
    toolCategories.find((c) => c.id === id) || { description: "", id, name: id }
  );
}

// Platform colors
const platformColors: Record<string, string> = {
  darwin: "text-zinc-400 border-zinc-500/30 bg-zinc-500/10",
  linux: "text-amber-400 border-amber-500/30 bg-amber-500/10",
  windows: "text-blue-400 border-blue-500/30 bg-blue-500/10",
};
---

<Layout title="Tools - DFIRHub">
  <Header client:load />

  <main id="main-content" class="flex-1 relative" tabindex="-1">
    <div class="mx-auto max-w-6xl px-4 py-8">
      <!-- Breadcrumb -->
      <nav
        class="mb-6 text-xs text-muted-foreground animate-in"
        aria-label="Breadcrumb"
      >
        <ol class="flex items-center gap-1">
          <li>
            <a
              href="/"
              class="hover:text-foreground transition-colors focus-ring rounded-sm px-1"
            >
              <span class="text-primary">~</span>/
            </a>
          </li>
          <li class="flex items-center gap-1">
            <span aria-hidden="true">/</span>
            <span class="text-foreground px-1" aria-current="page">tools</span>
          </li>
        </ol>
      </nav>

      <!-- Header -->
      <header class="mb-8 animate-in" style="animation-delay: 50ms;">
        <h1 class="text-2xl font-semibold mb-2">Forensic Tools</h1>
        <p class="text-sm text-muted-foreground">
          Collection of <span class="text-primary">{tools.length}</span>
          forensic tools integrated with DFIRHub for artifact extraction and
          analysis
        </p>
      </header>

      <!-- Stats -->
      <div
        class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 animate-in"
        style="animation-delay: 100ms;"
      >
        <div class="border border-border bg-card/30 rounded-lg p-4">
          <div class="text-2xl font-semibold text-primary">{tools.length}</div>
          <div class="text-xs text-muted-foreground">total tools</div>
        </div>
        <div class="border border-border bg-card/30 rounded-lg p-4">
          <div class="text-2xl font-semibold text-blue-400">
            {tools.filter(t => t.platforms.includes("Windows")).length}
          </div>
          <div class="text-xs text-muted-foreground">windows</div>
        </div>
        <div class="border border-border bg-card/30 rounded-lg p-4">
          <div class="text-2xl font-semibold text-amber-400">
            {tools.filter(t => t.platforms.includes("Linux")).length}
          </div>
          <div class="text-xs text-muted-foreground">linux</div>
        </div>
        <div class="border border-border bg-card/30 rounded-lg p-4">
          <div class="text-2xl font-semibold text-zinc-400">
            {tools.filter(t => t.platforms.includes("Darwin")).length}
          </div>
          <div class="text-xs text-muted-foreground">macos</div>
        </div>
      </div>

      <!-- Quick Links -->
      <section class="mb-8 animate-in" style="animation-delay: 150ms;">
        <h2
          class="text-xs uppercase tracking-wider text-muted-foreground mb-3 flex items-center gap-2"
        >
          <span class="text-primary/50" aria-hidden="true">//</span>
          quick navigation
        </h2>
        <div class="flex flex-wrap gap-2">
          {Array.from(toolsByCategory.keys()).map(categoryId => {
            const category = getCategoryInfo(categoryId);
            const count = toolsByCategory.get(categoryId)?.length || 0;
            return (
              <a
                href={`#${categoryId}`}
                class="inline-flex items-center gap-2 px-3 py-1.5 text-xs border border-border/50 bg-secondary/30 rounded-md hover:border-primary/50 hover:bg-primary/5 transition-colors"
              >
                <span>{category.name}</span>
                <span class="text-muted-foreground">({count})</span>
              </a>
            );
          })}
        </div>
      </section>

      <!-- Tools by Category -->
      {Array.from(toolsByCategory.entries()).map(([categoryId, categoryTools], catIndex) => {
        const category = getCategoryInfo(categoryId);
        return (
          <section class="mb-10 animate-in" id={categoryId} style={`animation-delay: ${200 + catIndex * 50}ms;`}>
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xs uppercase tracking-wider text-muted-foreground flex items-center gap-2">
                <span class="text-primary/50" aria-hidden="true">//</span>
                {category.name}
                <span class="text-primary">({categoryTools.length})</span>
              </h2>
            </div>
            {category.description && (
              <p class="text-sm text-muted-foreground mb-4">{category.description}</p>
            )}

            <div class="border border-border bg-card/20 rounded-lg overflow-hidden">
              {categoryTools.map((tool, index) => (
                <div class={`p-4 ${index > 0 ? 'border-t border-border/50' : ''} hover:bg-card/30 transition-colors`}>
                  <div class="flex items-start justify-between gap-4">
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-1">
                        <span class="font-medium text-foreground">{tool.name}</span>
                        {tool.website && (
                          <a
                            href={tool.website}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="text-xs text-primary hover:text-primary/80 transition-colors"
                          >
                            [docs]
                          </a>
                        )}
                      </div>
                      <p class="text-sm text-muted-foreground mb-3">{tool.description}</p>
                      <div class="flex flex-wrap gap-2">
                        {tool.platforms.map(platform => (
                          <span class={`px-2 py-0.5 text-[10px] uppercase tracking-wider border rounded-sm ${platformColors[platform.toLowerCase()] || "text-muted-foreground border-border"}`}>
                            {platform.toLowerCase()}
                          </span>
                        ))}
                        {tool.sourceTypes.map(type => (
                          <span class="px-2 py-0.5 text-[10px] uppercase tracking-wider text-muted-foreground border border-border/50 rounded-sm">
                            {type.toLowerCase().replace(/_/g, ' ')}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>

                  <!-- Command Template Preview -->
                  <div class="mt-3">
                    <pre class="p-3 bg-black/40 rounded-md text-xs text-green-400/80 overflow-x-auto"><code><span class="text-primary select-none">$ </span>{tool.commandTemplate}</code></pre>
                  </div>
                </div>
              ))}
            </div>
          </section>
        );
      })}
    </div>
  </main>

  <Footer />
</Layout>

<style>
  .animate-in {
    opacity: 0;
    animation: animate-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  @keyframes animate-in {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
