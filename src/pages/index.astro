---
import { ScrollReveal } from "../components/artifact/ArtifactContent";
import { CategoryFilters } from "../components/artifacts/CategoryFilters";
import Footer from "../components/layout/Footer.astro";
import { Header } from "../components/layout/Header";
import { AnimatedSearch } from "../components/search/AnimatedSearch";
import Layout from "../layouts/Layout.astro";
import { getStats, loadAllTargets } from "../lib/kapefiles";

const stats = getStats();
const allTargets = loadAllTargets();

// Investigation scenarios with artifact mappings
const scenarios = [
  {
    id: "lateral-movement",
    title: "Lateral Movement",
    description: "Track attacker movement across network",
    artifacts: [
      "rdpcache",
      "eventlogs-rdp",
      "eventlogs",
      "psexec",
      "bits",
      "smbclient",
      "networkprofiles",
    ],
    keywords: ["RDP", "PSExec", "WinRM", "Event Logs", "Network"],
    color: "cyan" as const,
  },
  {
    id: "browser-forensics",
    title: "Browser Forensics",
    description: "Analyze web activity and downloads",
    artifacts: [
      "chrome",
      "firefox",
      "edge",
      "ienetcache",
      "browsercache",
      "chromiumextensions",
    ],
    keywords: ["Chrome", "Firefox", "Edge", "History", "Downloads"],
    color: "blue" as const,
  },
  {
    id: "persistence",
    title: "Persistence",
    description: "Find malware survival mechanisms",
    artifacts: [
      "scheduledtasks",
      "registryhivesuser",
      "registryhivessystem",
      "startupfolders",
      "services",
      "wbem",
      "mof",
    ],
    keywords: ["Run Keys", "Services", "Tasks", "Startup", "WMI"],
    color: "red" as const,
  },
  {
    id: "execution",
    title: "Program Execution",
    description: "Evidence of program execution",
    artifacts: [
      "prefetch",
      "amcache",
      "shimcache",
      "srum",
      "appcompatpca",
      "userassist",
      "bam",
    ],
    keywords: ["Prefetch", "Amcache", "ShimCache", "SRUM", "BAM"],
    color: "green" as const,
  },
  {
    id: "user-activity",
    title: "User Activity",
    description: "Reconstruct user behavior timeline",
    artifacts: [
      "shellbags",
      "recentfilecache",
      "jumplists",
      "lnkfiles",
      "thumbcache",
      "wordwheelquery",
    ],
    keywords: ["Shellbags", "Recent", "Jump Lists", "LNK", "MRU"],
    color: "purple" as const,
  },
  {
    id: "anti-forensics",
    title: "Data Recovery",
    description: "Recover deleted and hidden data",
    artifacts: [
      "$mft",
      "$j",
      "$logfile",
      "recyclebin",
      "$usnjrnl",
      "vss",
      "thumbcache",
    ],
    keywords: ["$MFT", "$J", "USN Journal", "Recycle Bin", "VSS"],
    color: "amber" as const,
  },
];

// Count matching artifacts for each scenario
const scenariosWithCounts = scenarios.map((scenario) => {
  const count = allTargets.filter((t) =>
    scenario.artifacts.some((a) =>
      t.slug.toLowerCase().includes(a.toLowerCase())
    )
  ).length;
  return {
    id: scenario.id,
    title: scenario.title,
    description: scenario.description,
    keywords: scenario.keywords,
    color: scenario.color,
    count: Math.max(count, scenario.artifacts.length),
  };
});

// Expanded popular artifacts for marquee - get more artifacts
const popularSlugsRow1 = [
  "prefetch",
  "amcache",
  "eventlogs",
  "registryhivesuser",
  "chrome",
  "srum",
  "shimcache",
  "firefox",
  "edge",
  "scheduledtasks",
  "mft",
  "usnjrnl",
];
const popularSlugsRow2 = [
  "jumplists",
  "lnkfiles",
  "shellbags",
  "recyclebin",
  "bits",
  "rdpcache",
  "windowstimeline",
  "thumbcache",
  "userassist",
  "bam",
  "anydesk",
  "teamviewer",
];

const popularArtifactsRow1 = popularSlugsRow1
  .map((slug) =>
    allTargets.find((t) => t.slug.toLowerCase() === slug.toLowerCase())
  )
  .filter(Boolean);

const popularArtifactsRow2 = popularSlugsRow2
  .map((slug) =>
    allTargets.find((t) => t.slug.toLowerCase() === slug.toLowerCase())
  )
  .filter(Boolean);

// Category pills for quick filtering (links to /artifacts with filter)
const categories = [
  { id: "all", label: "All", count: stats.total },
  { id: "windows", label: "Windows", count: stats.byCategory.Windows || 0 },
  {
    id: "browsers",
    label: "Browsers",
    count: stats.byCategory.Browsers || 0,
  },
  { id: "apps", label: "Apps", count: stats.byCategory.Apps || 0 },
  {
    id: "antivirus",
    label: "Antivirus",
    count: stats.byCategory.Antivirus || 0,
  },
];

// Scenario color classes for hero grid
const scenarioColorMap = {
  cyan: { icon: "text-cyan-400", iconBg: "bg-cyan-500/10", glow: "bg-cyan-500/[0.07]" },
  blue: { icon: "text-blue-400", iconBg: "bg-blue-500/10", glow: "bg-blue-500/[0.07]" },
  red: { icon: "text-red-400", iconBg: "bg-red-500/10", glow: "bg-red-500/[0.07]" },
  green: { icon: "text-green-400", iconBg: "bg-green-500/10", glow: "bg-green-500/[0.07]" },
  purple: { icon: "text-purple-400", iconBg: "bg-purple-500/10", glow: "bg-purple-500/[0.07]" },
  amber: { icon: "text-amber-400", iconBg: "bg-amber-500/10", glow: "bg-amber-500/[0.07]" },
};

// Tool cards
const tools = [
  {
    title: "Artifact Explorer",
    description:
      "Browse and search all forensic artifacts with detailed paths, categories, and collection targets",
    href: "/artifacts",
    icon: "search",
    color: "emerald",
    stat: `${stats.total} artifacts`,
  },
  {
    title: "Script Builder",
    description:
      "Generate KAPE collection scripts by selecting exactly the artifacts you need for your investigation",
    href: "/builder",
    icon: "wrench",
    color: "amber",
    stat: "Custom scripts",
  },
  {
    title: "Sigma Converter",
    description:
      "Convert Sigma detection rules to any SIEM query language, entirely in your browser with pySigma",
    href: "/converter",
    icon: "sigma",
    color: "violet",
    stat: "15+ backends",
  },
  {
    title: "Collections",
    description:
      "Pre-built forensic collection profiles for common investigation scenarios and triage workflows",
    href: "/collections",
    icon: "layers",
    color: "cyan",
    stat: "Ready to use",
  },
];
---

<Layout title="DFIRHub">
  <div class="min-h-screen w-full overflow-x-hidden">
    <Header client:load />

    <main>
      <!-- Hero -->
      <div class="hero-section relative overflow-visible">
        <!-- Background atmosphere -->
        <div
          class="pointer-events-none absolute inset-0 overflow-hidden"
          aria-hidden="true"
        >
          <div class="hero-dots absolute inset-0 opacity-[0.035]"></div>
          <!-- Aurora gradient blobs -->
          <div
            class="animate-aurora-1 absolute -left-32 -top-24 h-[500px] w-[600px] rounded-full bg-primary/[0.06] blur-[100px]"
          ></div>
          <div
            class="animate-aurora-2 absolute -right-32 top-12 h-[400px] w-[500px] rounded-full bg-emerald-500/[0.04] blur-[120px]"
          ></div>
          <!-- Bottom fade -->
          <div
            class="absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-background to-transparent"
          ></div>
        </div>

        <div
          class="relative mx-auto max-w-6xl px-4 pb-12 pt-16 sm:pb-20 sm:pt-24"
        >
          <div>
            <div class="text-center lg:text-left">
              <!-- Eyebrow -->
              <div class="mb-6 flex justify-center lg:justify-start">
                <div
                  class="inline-flex items-center gap-2 rounded-full border border-primary/30 bg-primary/[0.06] px-3 py-1"
                >
                  <span
                    class="h-1.5 w-1.5 rounded-full bg-primary animate-pulse"
                  ></span>
                  <span
                    class="text-[11px] text-primary/80 font-medium tracking-wide"
                    ><span class="font-mono">{stats.total}</span> artifacts
                    indexed</span
                  >
                </div>
              </div>

              <!-- Heading -->
              <h1
                class="mx-auto max-w-2xl text-4xl font-bold leading-tight tracking-tight sm:text-5xl md:text-6xl lg:mx-0"
              >
                Find forensic artifacts,
                <span class="hero-accent relative">
                  <span class="relative z-10 text-gradient-primary">fast</span>
                  <span
                    class="absolute -inset-x-2 bottom-0 h-[0.35em] bg-primary/10 rounded-sm"
                    aria-hidden="true"
                  ></span>
                </span>
              </h1>

              <p
                class="mx-auto mt-4 max-w-lg text-sm text-muted-foreground sm:mt-5 sm:text-base lg:mx-0"
              >
                Search artifact paths, build collection scripts, and convert
                Sigma rules. All in one place.
              </p>

              <!-- Search -->
              <div class="mx-auto mt-8 max-w-xl sm:mt-10 lg:mx-0">
                <AnimatedSearch client:load />
              </div>

              <!-- Category Pills -->
              <div class="mt-6 flex justify-center sm:mt-8 lg:justify-start">
                <CategoryFilters client:idle categories={categories} />
              </div>

              <!-- Scenario Quick Links -->
              <div class="mt-5 flex items-center justify-center gap-3 sm:mt-6 lg:justify-start">
                <span class="text-[10px] uppercase tracking-widest text-muted-foreground">Investigate by scenario</span>
                <div class="h-px w-4 bg-border/20" aria-hidden="true"></div>
              </div>
              <div class="scroll-shadow-x" id="scenario-scroll-wrapper">
              <div class="mt-2.5 flex gap-2 overflow-x-auto scrollbar-hide lg:flex-wrap lg:justify-start" id="scenario-scroll">
                {scenariosWithCounts.map((scenario) => {
                  const colors = scenarioColorMap[scenario.color] || scenarioColorMap.cyan;
                  return (
                    <a
                      href={`/artifacts?scenario=${scenario.id}`}
                      class:list={[
                        "group inline-flex shrink-0 items-center gap-2 rounded-full border border-white/[0.06] bg-white/[0.02] pl-1.5 pr-3 py-1",
                        "text-xs text-muted-foreground transition-all duration-200",
                        "hover:border-white/[0.12] hover:bg-white/[0.05] hover:text-foreground",
                      ]}
                    >
                      <div class:list={["flex h-5 w-5 items-center justify-center rounded-full", colors.iconBg]}>
                        <svg aria-hidden="true" class:list={["h-3 w-3", colors.icon]} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          {scenario.id === "lateral-movement" && <path d="M5.25 14.25h13.5m-13.5 0a3 3 0 0 1-3-3m3 3a3 3 0 1 0 0 6h13.5a3 3 0 1 0 0-6m-16.5-3a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3m-19.5 0a4.5 4.5 0 0 1 .9-2.7L5.737 5.1a3.375 3.375 0 0 1 2.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 0 1 .9 2.7m0 0a3 3 0 0 1-3 3m0 3h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Zm-3 6h.008v.008h-.008v-.008Zm0-6h.008v.008h-.008v-.008Z" />}
                          {scenario.id === "browser-forensics" && <><path d="M21 12a9 9 0 1 0-9 9" /><path d="M3.6 9h16.8" /><path d="M3.6 15h7.9" /><path d="M11.5 3a17 17 0 0 0 0 18" /><path d="M12.5 3a16.984 16.984 0 0 1 2.574 8.62" /><path d="M15 18a3 3 0 1 0 6 0 3 3 0 1 0-6 0" /><path d="M20.2 20.2l1.8 1.8" /></>}
                          {scenario.id === "persistence" && <path d="M7.864 4.243A7.5 7.5 0 0 1 19.5 10.5c0 2.92-.556 5.709-1.568 8.268M5.742 6.364A7.465 7.465 0 0 0 4.5 10.5a7.464 7.464 0 0 1-1.15 3.993m1.989 3.559A11.209 11.209 0 0 0 8.25 10.5a3.75 3.75 0 1 1 7.5 0c0 .527-.021 1.049-.064 1.565M12 10.5a14.94 14.94 0 0 1-3.6 9.75m6.633-4.596a18.666 18.666 0 0 1-2.485 5.33" />}
                          {scenario.id === "execution" && <path d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z" />}
                          {scenario.id === "user-activity" && <path d="M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59" />}
                          {scenario.id === "anti-forensics" && <path d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />}
                        </svg>
                      </div>
                      <span>{scenario.title}</span>
                    </a>
                  );
                })}
              </div>
              </div>

              <!-- Quick stats row -->
              <div
                class="mx-auto mt-10 flex max-w-md items-center justify-center gap-6 text-xs text-muted-foreground/50 sm:mt-14 sm:gap-10 lg:mx-0 lg:justify-start"
              >
                <div class="flex flex-col items-center gap-1 lg:items-start">
                  <span
                    class="text-lg font-semibold text-foreground/80 font-mono tabular-nums"
                    >{stats.total}</span
                  >
                  <span>Artifacts</span>
                </div>
                <div class="h-6 w-px bg-border/30" aria-hidden="true"></div>
                <div class="flex flex-col items-center gap-1 lg:items-start">
                  <span
                    class="text-lg font-semibold text-foreground/80 font-mono tabular-nums"
                    >{Object.keys(stats.byCategory).length}</span
                  >
                  <span>Categories</span>
                </div>
                <div class="h-6 w-px bg-border/30" aria-hidden="true"></div>
                <div class="flex flex-col items-center gap-1 lg:items-start">
                  <span
                    class="text-lg font-semibold text-foreground/80 font-mono tabular-nums"
                    >15+</span
                  >
                  <span>SIEM backends</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mx-auto max-w-6xl px-4">
        <!-- Tools Section -->
        <ScrollReveal client:visible>
          <section class="py-10 sm:py-16">
            <div class="mb-6 flex items-center gap-4 sm:mb-8">
              <h2 class="text-xs text-muted-foreground sm:text-sm">
                <span class="text-primary font-mono">//</span> TOOLS
              </h2>
              <div
                class="h-px flex-1 bg-gradient-to-r from-border/40 to-transparent"
                aria-hidden="true"
              ></div>
            </div>

            <div
              class="grid grid-cols-1 gap-3 sm:grid-cols-2 sm:gap-4 lg:grid-cols-3"
            >
              <!-- Featured: Artifact Explorer â€” full width -->
              <a
                href={tools[0].href}
                class="tool-card tool-featured group relative col-span-1 overflow-hidden rounded-xl border border-primary/10 p-6 transition-all duration-300 ease-out sm:col-span-2 sm:p-8 lg:col-span-3"
              >
                <div
                  class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between"
                >
                  <div class="flex-1">
                    <div class="mb-4 flex items-center gap-3">
                      <div
                        class="flex h-10 w-10 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-400"
                      >
                        <svg
                          aria-hidden="true"
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <circle cx="11" cy="11" r="8"></circle>
                          <path d="m21 21-4.3-4.3"></path>
                        </svg>
                      </div>
                      <span
                        class="rounded-full bg-emerald-500/10 px-2.5 py-0.5 text-[10px] font-medium text-emerald-400/70"
                      >
                        {tools[0].stat}
                      </span>
                    </div>
                    <h3
                      class="mb-2 text-base font-medium text-foreground transition-colors group-hover:text-foreground sm:text-lg"
                    >
                      {tools[0].title}
                    </h3>
                    <p
                      class="max-w-lg text-xs leading-relaxed text-muted-foreground/70 sm:text-sm"
                    >
                      {tools[0].description}
                    </p>
                    <div
                      class="mt-4 flex items-center gap-1 text-xs text-muted-foreground/40 transition-colors group-hover:text-primary/60"
                    >
                      <span>Explore</span>
                      <svg
                        aria-hidden="true"
                        width="12"
                        height="12"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="transition-transform group-hover:translate-x-0.5"
                      >
                        <path d="M5 12h14"></path>
                        <path d="m12 5 7 7-7 7"></path>
                      </svg>
                    </div>
                  </div>
                </div>
                <!-- Subtle corner glow on hover -->
                <div
                  class="pointer-events-none absolute -right-16 -top-16 h-40 w-40 rounded-full bg-emerald-500/[0.07] opacity-0 blur-3xl transition-opacity duration-500 group-hover:opacity-100"
                  aria-hidden="true"
                ></div>
              </a>

              <!-- Secondary tool cards -->
              {tools.slice(1).map((tool) => (
                  <a
                    href={tool.href}
                    class:list={[
                      "tool-card group relative overflow-hidden rounded-xl p-5 sm:p-6",
                      "border border-white/[0.06] bg-white/[0.02]",
                      "transition-all duration-300 ease-out",
                      "hover:border-white/[0.12] hover:bg-white/[0.04]",
                    ]}
                  >
                    <!-- Top gradient accent line -->
                    <div
                      class:list={[
                        "absolute inset-x-0 top-0 h-px",
                        tool.color === "amber" && "bg-gradient-to-r from-transparent via-amber-500/40 to-transparent",
                        tool.color === "violet" && "bg-gradient-to-r from-transparent via-violet-500/40 to-transparent",
                        tool.color === "cyan" && "bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent",
                      ]}
                      aria-hidden="true"
                    />

                    <div class="mb-4 flex items-start justify-between">
                      <div
                        class:list={[
                          "flex h-9 w-9 items-center justify-center rounded-lg",
                          tool.color === "amber" &&
                            "bg-amber-500/10 text-amber-400",
                          tool.color === "violet" &&
                            "bg-violet-500/10 text-violet-400",
                          tool.color === "cyan" &&
                            "bg-cyan-500/10 text-cyan-400",
                        ]}
                      >
                        {tool.icon === "wrench" && (
                          <svg
                            aria-hidden="true"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          >
                            <path d="m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9" />
                            <path d="m18 15 4-4" />
                            <path d="m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5" />
                          </svg>
                        )}
                        {tool.icon === "sigma" && (
                          <svg
                            aria-hidden="true"
                            width="18"
                            height="18"
                            viewBox="155 155 750 625"
                            fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="m890.394412 165c3.019653 25.589448-5.253407 50.2282-24.819179 73.916253-19.565772 23.688054-45.907539 35.53208-79.025312 35.53208l-62.977337.363397c39.393202 52.779296 59.977836 120.64775 53.603978 194.68827-14.47716 168.170707-162.549778 304.5-330.729454 304.5s-292.780187-136.329293-278.30303-304.5c14.477156-168.170706 162.549776-304.5 330.729452-304.5zm-401.090784 111.166667c-106.780747 0-200.795108 86.558282-209.986954 193.333334s69.91959 193.333333 176.700337 193.333333c106.780746 0 200.795108-86.558281 209.986952-193.333333 9.191849-106.775052-69.919588-193.333334-176.700335-193.333334z" />
                          </svg>
                        )}
                        {tool.icon === "layers" && (
                          <svg
                            aria-hidden="true"
                            width="18"
                            height="18"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          >
                            <path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z" />
                            <path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65" />
                            <path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65" />
                          </svg>
                        )}
                      </div>
                      <span
                        class:list={[
                          "rounded-full px-2 py-0.5 text-[10px] font-medium",
                          tool.color === "amber" &&
                            "bg-amber-500/10 text-amber-400/70",
                          tool.color === "violet" &&
                            "bg-violet-500/10 text-violet-400/70",
                          tool.color === "cyan" &&
                            "bg-cyan-500/10 text-cyan-400/70",
                        ]}
                      >
                        {tool.stat}
                      </span>
                    </div>

                    <h3 class="mb-1.5 text-sm font-medium text-foreground transition-colors group-hover:text-foreground sm:text-base">
                      {tool.title}
                    </h3>
                    <p class="text-xs leading-relaxed text-muted-foreground/70 sm:text-sm">
                      {tool.description}
                    </p>

                    <div class="mt-4 flex items-center gap-1 text-xs text-muted-foreground/40 transition-colors group-hover:text-primary/60">
                      <span>Explore</span>
                      <svg
                        aria-hidden="true"
                        width="12"
                        height="12"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="transition-transform group-hover:translate-x-0.5"
                      >
                        <path d="M5 12h14" />
                        <path d="m12 5 7 7-7 7" />
                      </svg>
                    </div>

                    <!-- Subtle corner glow on hover -->
                    <div
                      class:list={[
                        "pointer-events-none absolute -right-12 -top-12 h-32 w-32 rounded-full opacity-0 blur-3xl transition-opacity duration-500 group-hover:opacity-100",
                        tool.color === "amber" && "bg-amber-500/[0.07]",
                        tool.color === "violet" && "bg-violet-500/[0.07]",
                        tool.color === "cyan" && "bg-cyan-500/[0.07]",
                      ]}
                      aria-hidden="true"
                    />
                  </a>
                ))}
            </div>
          </section>
        </ScrollReveal>

        <!-- Why DFIRHub -->
        <ScrollReveal client:visible>
          <section class="border-t border-border/20 py-10 sm:py-16">
            <div class="mb-6 flex items-center gap-4 sm:mb-8">
              <h2 class="text-xs text-muted-foreground sm:text-sm">
                <span class="text-primary font-mono">//</span> WHY DFIRHUB
              </h2>
              <div
                class="h-px flex-1 bg-gradient-to-r from-border/40 to-transparent"
                aria-hidden="true"
              ></div>
            </div>

            <div class="grid grid-cols-1 gap-3 sm:grid-cols-3 sm:gap-4">
              <!-- Always Current -->
              <div
                class="rounded-xl border border-white/[0.06] bg-white/[0.02] p-5 sm:p-6"
              >
                <div
                  class="mb-4 flex h-9 w-9 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-400"
                >
                  <svg
                    aria-hidden="true"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21.5 2v6h-6"></path>
                    <path d="M2.5 22v-6h6"></path>
                    <path d="M2.5 11.5a10 10 0 0 1 18.8-4.3"></path>
                    <path d="M21.5 12.5a10 10 0 0 1-18.8 4.2"></path>
                  </svg>
                </div>
                <h3
                  class="mb-1.5 text-sm font-medium text-foreground sm:text-base"
                >
                  Always Current
                </h3>
                <p
                  class="text-xs leading-relaxed text-muted-foreground/70 sm:text-sm"
                >
                  Artifacts synced weekly from KapeFiles. Always up to date with
                  the latest forensic targets.
                </p>
              </div>

              <!-- Browser-Native -->
              <div
                class="rounded-xl border border-white/[0.06] bg-white/[0.02] p-5 sm:p-6"
              >
                <div
                  class="mb-4 flex h-9 w-9 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-400"
                >
                  <svg
                    aria-hidden="true"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect width="18" height="18" x="3" y="3" rx="2"></rect>
                    <path d="M3 9h18"></path>
                    <path d="M9 21V9"></path>
                  </svg>
                </div>
                <h3
                  class="mb-1.5 text-sm font-medium text-foreground sm:text-base"
                >
                  Browser-Native
                </h3>
                <p
                  class="text-xs leading-relaxed text-muted-foreground/70 sm:text-sm"
                >
                  Everything runs in your browser. No server, no telemetry, no
                  data leaves your machine.
                </p>
              </div>

              <!-- Investigation-Ready -->
              <div
                class="rounded-xl border border-white/[0.06] bg-white/[0.02] p-5 sm:p-6"
              >
                <div
                  class="mb-4 flex h-9 w-9 items-center justify-center rounded-lg bg-emerald-500/10 text-emerald-400"
                >
                  <svg
                    aria-hidden="true"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" x2="20" y1="19" y2="19"></line>
                  </svg>
                </div>
                <h3
                  class="mb-1.5 text-sm font-medium text-foreground sm:text-base"
                >
                  Investigation-Ready
                </h3>
                <p
                  class="text-xs leading-relaxed text-muted-foreground/70 sm:text-sm"
                >
                  From artifact lookup to collection script in seconds. Built
                  for DFIR practitioners.
                </p>
              </div>
            </div>
          </section>
        </ScrollReveal>



        <!-- Popular Artifacts - Marquee -->
        <ScrollReveal client:visible delay={0.1}>
          <section class="border-t border-border/20 py-10 sm:py-16">
            <div class="mb-6 flex items-center gap-4 sm:mb-8">
              <h2 class="text-xs text-muted-foreground sm:text-sm">
                <span class="text-primary font-mono">//</span> POPULAR ARTIFACTS
              </h2>
              <div
                class="h-px flex-1 bg-gradient-to-r from-border/40 to-transparent"
                aria-hidden="true"
              ></div>
              <a
                href="/artifacts"
                class="flex-shrink-0 text-xs text-primary hover:text-primary/80 transition-colors"
              >
                view all &rarr;
              </a>
            </div>

            <!-- Marquee Container -->
            <div class="relative overflow-hidden">
              <!-- Fade edges -->
              <div
                class="pointer-events-none absolute bottom-0 left-0 top-0 z-10 w-8 bg-gradient-to-r from-background to-transparent sm:w-20"
              ></div>
              <div
                class="pointer-events-none absolute bottom-0 right-0 top-0 z-10 w-8 bg-gradient-to-l from-background to-transparent sm:w-20"
              ></div>

              <!-- Row 1 - scrolls left -->
              <div class="marquee-row mb-3">
                <div class="marquee-content animate-marquee">
                  {[
                      ...popularArtifactsRow1,
                      ...popularArtifactsRow1,
                    ].map((artifact) => {
                      if (!artifact) return null;
                      const href = "/artifact/" + artifact.slug;
                      const pathCount = artifact.isCompound
                        ? artifact.referencedTargets.length + " targets"
                        : artifact.targets.filter(
                            (e) => !e.path.endsWith(".tkape")
                          ).length + " paths";
                      return (
                        <a
                          href={href}
                          class="marquee-item group flex-shrink-0 w-44 sm:w-60 p-3 sm:p-4 glass-card rounded-xl hover:border-primary/40"
                        >
                          <h3 class="mb-1 flex items-center gap-1.5 truncate text-xs font-medium transition-colors group-hover:text-primary sm:text-sm">
                            <span class="h-1.5 w-1.5 flex-shrink-0 rounded-full bg-primary/60" aria-hidden="true"></span>
                            {artifact.name}
                          </h3>
                          <p class="mb-2 truncate text-[10px] text-muted-foreground sm:text-xs">
                            {artifact.description || "Forensic artifact"}
                          </p>
                          <div class="flex items-center gap-1.5 text-[9px] sm:gap-2 sm:text-[10px]">
                            <span class="rounded bg-white/[0.04] px-1.5 py-0.5 uppercase text-muted-foreground/50">
                              {artifact.category}
                            </span>
                            <span class="font-mono tabular-nums text-muted-foreground/50">
                              {pathCount}
                            </span>
                          </div>
                        </a>
                      );
                    })}
                </div>
              </div>

              <!-- Row 2 - scrolls right -->
              <div class="marquee-row">
                <div class="marquee-content animate-marquee-reverse">
                  {[
                      ...popularArtifactsRow2,
                      ...popularArtifactsRow2,
                    ].map((artifact) => {
                      if (!artifact) return null;
                      const href = "/artifact/" + artifact.slug;
                      const pathCount = artifact.isCompound
                        ? artifact.referencedTargets.length + " targets"
                        : artifact.targets.filter(
                            (e) => !e.path.endsWith(".tkape")
                          ).length + " paths";
                      return (
                        <a
                          href={href}
                          class="marquee-item group flex-shrink-0 w-44 sm:w-60 p-3 sm:p-4 glass-card rounded-xl hover:border-primary/40"
                        >
                          <h3 class="mb-1 flex items-center gap-1.5 truncate text-xs font-medium transition-colors group-hover:text-primary sm:text-sm">
                            <span class="h-1.5 w-1.5 flex-shrink-0 rounded-full bg-primary/60" aria-hidden="true"></span>
                            {artifact.name}
                          </h3>
                          <p class="mb-2 truncate text-[10px] text-muted-foreground sm:text-xs">
                            {artifact.description || "Forensic artifact"}
                          </p>
                          <div class="flex items-center gap-1.5 text-[9px] sm:gap-2 sm:text-[10px]">
                            <span class="rounded bg-white/[0.04] px-1.5 py-0.5 uppercase text-muted-foreground/50">
                              {artifact.category}
                            </span>
                            <span class="font-mono tabular-nums text-muted-foreground/50">
                              {pathCount}
                            </span>
                          </div>
                        </a>
                      );
                    })}
                </div>
              </div>
            </div>
          </section>
        </ScrollReveal>
      </div>
    </main>

    <Footer />
  </div>
</Layout>

<style>
  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }
  :global(.animate-blink) {
    animation: blink 1s infinite;
  }

  /* ---- Hero background effects ---- */
  .hero-section {
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
  }

  .hero-dots {
    background-image: radial-gradient(
      circle,
      rgba(255, 255, 255, 0.5) 1px,
      transparent 1px
    );
    background-size: 32px 32px;
    mask-image: radial-gradient(
      ellipse 70% 60% at 50% 40%,
      black 20%,
      transparent 100%
    );
  }

  /* ---- Tool featured card ---- */
  .tool-featured {
    background: rgba(16, 185, 129, 0.02);
    border-color: rgba(16, 185, 129, 0.1);
  }
  .tool-featured:hover {
    background: rgba(16, 185, 129, 0.04);
    border-color: rgba(16, 185, 129, 0.18);
    box-shadow:
      0 0 0 1px rgba(16, 185, 129, 0.08),
      0 8px 32px -8px rgba(0, 0, 0, 0.4);
  }

  /* ---- Tool card subtle border glow ---- */
  .tool-card {
    background: rgba(255, 255, 255, 0.015);
  }
  .tool-card:hover {
    box-shadow:
      0 0 0 1px rgba(255, 255, 255, 0.06),
      0 8px 32px -8px rgba(0, 0, 0, 0.4);
  }

  /* ---- Marquee styles ---- */
  .marquee-row {
    display: flex;
    overflow: hidden;
  }

  .marquee-content {
    display: flex;
    gap: 0.75rem;
  }

  .marquee-item {
    flex-shrink: 0;
  }

  @keyframes marquee {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  @keyframes marquee-reverse {
    0% {
      transform: translateX(-50%);
    }
    100% {
      transform: translateX(0);
    }
  }

  .animate-marquee {
    animation: marquee 40s linear infinite;
  }

  .animate-marquee-reverse {
    animation: marquee-reverse 40s linear infinite;
  }

  /* Pause on hover */
  .marquee-row:hover .marquee-content {
    animation-play-state: paused;
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .animate-marquee,
    .animate-marquee-reverse {
      animation: none;
    }
    :global(.animate-pulse) {
      animation: none;
    }
    :global(.animate-blink) {
      animation: none;
    }
    :global(.animate-aurora-1),
    :global(.animate-aurora-2) {
      animation: none;
    }
  }
</style>

<script>
  function initScrollShadow(wrapperId: string, scrollId: string) {
    const wrapper = document.getElementById(wrapperId);
    const scroll = document.getElementById(scrollId);
    if (!wrapper || !scroll) return;

    const w = wrapper;
    const s = scroll;

    function check() {
      const atEnd = s.scrollLeft + s.clientWidth >= s.scrollWidth - 2;
      w.classList.toggle("scrolled-end", atEnd);
    }

    check();
    s.addEventListener("scroll", check, { passive: true });
    window.addEventListener("resize", check);
  }

  initScrollShadow("scenario-scroll-wrapper", "scenario-scroll");
</script>
